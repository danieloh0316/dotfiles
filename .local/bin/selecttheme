#!/bin/sh

set_alacritty_config() {
    CONFIG="$XDG_CONFIG_HOME"/alacritty
    sed -i '/import/c\import = ["'"$CONFIG"'/'"$1"'.toml"]' "$CONFIG"/alacritty.toml
}

set_nvim_config() {
    printf "require('colorschemes.%s')" "$1" > "$XDG_CONFIG_HOME"/nvim/lua/colorscheme.lua
}

set_waybar_config() {
    sed -i '/import/c\@import "./'"$1"'.css";' "$XDG_CONFIG_HOME"/waybar/style.css
    restartwaybar
}

set_fuzzel_config() {
    CONFIG="$XDG_CONFIG_HOME"/fuzzel
    cat "$CONFIG"/themes/"$1".ini > "$CONFIG"/fuzzel.ini
}

set_mako_config() {
    CONFIG="$XDG_CONFIG_HOME"/mako
    cat "$CONFIG"/themes/"$1" > "$CONFIG"/config
    sed -i "/VOLUME_ICON=/c\VOLUME_ICON=\"\$ICONS\"/volume-$2.png" ~/.local/bin/setvolume
    sed -i "/MUTE_ICON=/c\MUTE_ICON=\"\$ICONS\"/mute-$2.png" ~/.local/bin/setvolume
    makoctl reload
}

set_signal_config() {
    sed -i '/theme-setting/c\  "theme-setting": "'"$1"'",' "$XDG_CONFIG_HOME"/Signal/ephemeral.json
}

set_theme() {
    set_alacritty_config "$1"
    set_nvim_config "$1"
    set_waybar_config "$1"
    set_fuzzel_config "$1"
    set_mako_config "$1" "$2"
    set_signal_config "$2"
    setwal "$1"
}

THEMES="everforest
gruvbox-material
nord
rose-pine
rose-pine-dawn"

select_theme() {
    case "$1" in
      "everforest") set_theme everforest dark;;
      "gruvbox-material") set_theme gruvbox-material dark;;
      "nord") set_theme nord dark;;
      "rose-pine") set_theme rose-pine dark;;
      "rose-pine-dawn") set_theme rose-pine-dawn light;;
      "random") set_theme "$(printf "%s" "$THEMES" | shuf -n 1)" dark;;
      *) printf "Error: Invalid theme.\n"; exit 1;;
    esac
}

[ -n "$1" ] && select_theme "$1" && exit

OPTION=$(printf "%s" "$THEMES" | dmenu-wl -p "ï€¾  ")
select_theme "$OPTION"
